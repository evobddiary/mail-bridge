# Разговор за MailDocker проект

## Обща информация
- **Проект:** MailDocker - POP3 to IMAP система с обработка на писма
- **Дата:** 17 януари 2026
- **Цел:** Настройка на пощенска система на UNRAID server
- **Платформа:** UNRAID + Docker контейнер

## Какво се иска (Requirements)

### Основни изисквания:
1. **POP3 to IMAP конвертор** - система за изтегляне на поща от POP3 и качване към IMAP
2. **Обработка на писмата** - филтриране, сортиране, модификация
3. **Многопотребителска поддръжка** - няколко POP3 акаунта
4. **Локален IMAP сървър** - не външен (Gmail/Outlook)
5. **Сортиране по папки** - автоматично организиране на писмата
6. **iOS интеграция** - push нотификации за важни писма
7. **Обем:** 10-50 писма на ден
8. **Платформа:** UNRAID server с Docker

### Специфични нужди:
- Собствен iOS софтуер, който да получава push нотификации
- Автоматично сортиране на писмата по папки
- Маркиране на важни писма
- Тригване на push нотификации при определени условия

## Как може да се постигне (Solution Approach)

### Препоръчана архитектура:
```
POP3 accounts (N)
        │
        ▼
   fetchmail
        │
        ▼
 Python Mail Processor
   ├─ сортиране по папки
   ├─ маркиране
   └─ push trigger (HTTP)
        │
        ▼
     dovecot (IMAP)
        │
        ▼
   iOS app (IMAP + push API)
```

### Компоненти:
1. **fetchmail** - дърпа писма от POP3 сървъри
2. **Python processing layer** - обработка, филтриране, push нотификации
3. **dovecot** - локален IMAP сървър
4. **Custom Docker контейнер** - съдържа всичко в едно

### Предимства на подхода:
- Пълен контрол върху системата
- Лесно дебъгване и поддръжка
- Минимален "шум" в UNRAID (един контейнер)
- Сигурно съхранение на паролите (environment variables)
- Production-ready стабилност

## Технически детайли

### Архитектура
- **Docker контейнер** с Linux base
- **Maildir формат** за съхранение на поща
- **Volume mapping** за постоянни данни
- **Bridge network** в UNRAID
- **Environment variables** за пароли

### Технологии
- **fetchmail** - POP3 клиент (Debian/Alpine package)
- **dovecot** - IMAP сървър (Debian/Alpine package)
- **Python 3** - обработка и логика
- **requests** - HTTP заявки за push нотификации
- **Docker** - контейнеризация
- **UNRAID** - хост система

### Стъпки за имплементация
1. **Създаване на Dockerfile** с всички компоненти
2. **Конфигуриране на dovecot** за локален IMAP
3. **Настройка на fetchmail** за множество POP3 акаунти
4. **Python скрипт** за обработка на писма
5. **Push система** за iOS нотификации
6. **UNRAID template** за лесно инсталиране
7. **Logging и мониторинг** за поддръжка

### Файлова структура (UNRAID)
```
/appdata/mail-bridge/
├── config/
│   ├── fetchmailrc
│   ├── dovecot.conf
│   └── accounts.yaml
├── scripts/
│   ├── process_mail.py
│   └── push_notify.py
├── maildata/
│   └── vmail/
├── logs/
└── Dockerfile
```

## Бележки

### Сигурност:
- SSL/TLS за POP3 връзки
- IMAPS (993) за IMAP достъп
- Пароли в environment variables, не в plaintext
- Backup на maildata директорията

### Дебъгване:
- `docker logs mail-bridge` за логове
- `docker exec -it mail-bridge bash` за достъп до контейнера
- Dry-run опции за тестване
- Python logging за детайлна диагностика

### Предимства:
- **Изолация** - контейнерът е независим от UNRAID система
- **Постоянство** - пощата оцелява дори при изтриване на контейнер
- **Скалируемост** - лесно добавяне на нови акаунти
- **Мониторинг** - UNRAID следи състоянието на контейнера

### Следващи стъпки:
1. Готов Dockerfile + entrypoint скрипт
2. Минимален dovecot.conf
3. UNRAID template (copy/paste)
4. Logging + healthcheck
5. Web UI или мониторинг (по-късно)

---

*Този документ е създаден на базата на разговор от 17 януари 2026 г.*
